<div class="container">
  <section class="body-section-top">
    <mat-form-field class="form-search">
      <mat-label>Enter the city name...</mat-label>
      <input (keyup.enter)="searchCity()"
             [(ngModel)]="value"
             id="SearchBar"
             matInput
             name="Search bar"
             type="search">
      @if (value) {
        <button matSuffix matIconButton aria-label="Search" (click)="searchCity()">
          <mat-icon>search</mat-icon>
        </button>
      }
    </mat-form-field>

    <div class="search-results">
      @if (results$ | async; as results) {
        @if (results.length > 0) {
          <mat-list>
            @for (city of results; track city) {
              <mat-list-item (click)="selectCity(city)" [class.selected]="city === selectedCity">
                <mat-icon matListItemIcon>location_on</mat-icon>
                <div matListItemTitle>{{ city.display_name }}</div>
                <div matListItemLine>{{ city.lat }}, {{ city.lon }}</div>
              </mat-list-item>
            }
          </mat-list>
        }
      }
    </div>
  </section>

  <section class="body-section-bottom">
    @if (weatherResponse$ | async; as weather) {
      <mat-card appearance="outlined" class="city-card">
        <mat-card-header>
          <mat-card-title>Details</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Temperature: {{ (weather.main.temp - 273.15) | number:'1.1-1' }}°C</p>
          <p>Description: {{ weather.weather[0].description | titlecase }}</p>
        </mat-card-content>
        <mat-card-footer>
          <mat-chip-set aria-label="Weather details">
            <mat-chip>Humidity: {{ weather.main.humidity }}%</mat-chip>
            <mat-chip>Feels like: {{ (weather.main.feels_like - 273.15) | number:'1.1-1' }}°C</mat-chip>
            <mat-chip>Wind speed: {{ weather.wind.speed }} m/s</mat-chip>
            <mat-chip>Rain: {{ weather.rain?.['1h'] || 0 }} mm/h</mat-chip>
            <mat-chip>Min/Max: {{ (weather.main.temp_min - 273.15) | number:'1.1-1' }}°C
              / {{ (weather.main.temp_max - 273.15) | number:'1.1-1' }}°C
            </mat-chip>
          </mat-chip-set>
        </mat-card-footer>
      </mat-card>

      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Additional Weather Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p><strong>Pressure:</strong> {{ weather.main.pressure }} hPa</p>
          <p><strong>Visibility:</strong> {{ weather.visibility / 1000 }} km</p>
          <p><strong>Cloud Coverage:</strong> {{ weather.clouds.all }}%</p>
          <p><strong>Wind Direction:</strong> {{ weather.wind.deg }}°</p>
          @if (weather.wind.gust) {
            <p><strong>Wind Gust:</strong> {{ weather.wind.gust }} m/s</p>
          }
        </mat-card-content>
        <mat-card-footer>
          <p><small>Last updated: {{ weather.dt * 1000 | date:'medium' }}</small></p>
        </mat-card-footer>
      </mat-card>
    } @else {
      <mat-card appearance="outlined" class="city-card">
        <mat-card-header>
          <mat-card-title>City: Select a city to see weather</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Temperature: --</p>
          <p>Description: --</p>
        </mat-card-content>
        <mat-card-footer>
          <mat-chip-set aria-label="Weather details">
            <mat-chip>Humidity: --</mat-chip>
            <mat-chip>Feels like: --</mat-chip>
            <mat-chip>Wind speed: --</mat-chip>
            <mat-chip>Rain: --</mat-chip>
            <mat-chip>Max/Min: --</mat-chip>
          </mat-chip-set>
        </mat-card-footer>
      </mat-card>

      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Additional Weather Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Please select a city to view detailed weather information.</p>
        </mat-card-content>
      </mat-card>
    }
  </section>
</div>
